---
alwaysApply: true
---
# Git Workflow & Branching Strategy

This rule defines how the AI should guide users on Git workflow and branching practices.

## Branch Strategy

### Primary Branches

- **`main`**: Production-ready code. Always deployable. Protected by branch protection rules.
- **`develop`**: (Optional) Integration branch for features. Use if working on multiple features simultaneously.

### Feature Branches

All new work should be done on feature branches:

- **`feature/<description>`**: New features (e.g., `feature/transaction-management`)
- **`fix/<description>`**: Bug fixes (e.g., `fix/budget-calculation`)
- **`refactor/<description>`**: Code refactoring (e.g., `refactor/account-service`)
- **`docs/<description>`**: Documentation updates (e.g., `docs/api-documentation`)
- **`test/<description>`**: Test additions/improvements (e.g., `test/transaction-service`)

### Branch Naming Convention

- Use lowercase
- Separate words with hyphens (`-`)
- Be descriptive but concise
- Match commit message scope when possible

**Examples:**
- ✅ `feature/transaction-api`
- ✅ `fix/budget-alert-logic`
- ✅ `refactor/account-repository`
- ❌ `new-feature`
- ❌ `fix`
- ❌ `my_branch`

## AI Guidance Rules

When helping users with Git workflow:

1. **MANDATORY: Always create feature branch before committing** - NEVER commit directly to `main`
   - **Before ANY commit**: Check current branch with `git branch --show-current` or `git status`
   - **If on `main`**: MUST create a feature branch first, then commit to that branch
   - **If already on feature branch**: Proceed with commit
   - **Exception**: Only if user explicitly requests committing to main (very rare)
2. **Use appropriate branch prefixes** - Match the type of work (feature, fix, refactor, etc.)
3. **Help create branches from current state** - If user has uncommitted changes, create branch first to preserve them
4. **Guide PR workflow** - Remind users to push branches and create PRs, not direct pushes to main
5. **Respect branch protection** - Remind users that `main` is protected and requires PRs
6. **Update implementation plan** - After each commit, update `doc/implementation_plan.md` with a summary of what changed in that commit (if it exists)

## Pre-Commit Checklist (MANDATORY)

**BEFORE creating ANY commit, the AI MUST:**

1. **Check current branch**: Run `git branch --show-current` or check `git status`
2. **If on `main` branch**:
   - **STOP** - Do NOT commit
   - Determine appropriate branch name based on commit type (feature/fix/refactor/test/docs)
   - Create feature branch: `git checkout -b <branch-name>`
   - **THEN** proceed with commit
3. **If on feature branch**: Proceed with commit
4. **After commit**: Update `doc/implementation_plan.md` if applicable

## Moving Changes from Main

If user has been working directly on `main`:

1. **For uncommitted changes:**
   - Create feature branch first (this moves uncommitted changes)
   - Then commit on the feature branch
   - Reset main to match remote

2. **For committed changes:**
   - Create feature branch from current state (includes commits)
   - Push feature branch
   - Reset main to match remote

## Branch Protection

The `main` branch is protected with:
- Pull requests required before merging
- CI checks must pass (lint, type-check, test, build)
- Gitleaks scan must pass
- At least 1 approval required
- No force pushes allowed

**Always remind users**: They cannot push directly to `main` - all changes must go through a PR.

## Implementation Plan Updates

**IMPORTANT**: After each commit, the AI must update `doc/implementation_plan.md` to document what changed (if the file exists).

### When to Update

- After creating a commit (before or immediately after)
- When committing changes that affect features, services, or functionality
- When adding new features, fixing bugs, or refactoring code

### What to Document

1. **Feature additions**: New services, controllers, entities, or functionality
2. **Bug fixes**: Issues resolved and how they were fixed
3. **Refactoring**: Code structure improvements or reorganization
4. **Configuration changes**: New config files, environment variables, or settings
5. **Documentation updates**: Changes to docs, README, or comments

### How to Update

1. Read the current `doc/implementation_plan.md` to understand its structure
2. Add a new entry in the appropriate section (or create a new section if needed)
3. Include:
   - Brief description of what changed
   - Files affected (if significant)
   - Impact on existing features
   - Any breaking changes or migration notes
4. Update the implementation checklist if applicable
5. Keep entries concise but informative

### Format Example

```markdown
## Recent Changes

### [Date/Commit] - Feature: Transaction Management API
- Added TransactionController with REST endpoints for CRUD operations
- Implemented TransactionService with BigDecimal precision
- Added Transaction entity with JPA annotations
- Files: `src/main/java/.../controller/TransactionController.java`, `src/main/java/.../service/TransactionService.java`
```

## Related Rules

- **Test Maintenance**: See `test-maintenance.mdc` for rules on updating tests when editing code
- **Commit Standards**: See `commit-standards.mdc` for commit message format
- **Commit Splitting**: See `commit-splitting.mdc` for when to split vs combine commits

## Reference

For detailed human-readable documentation, see `doc/GIT_WORKFLOW.md` (if it exists).
